select * from emp

CREATE TABLE CUSTOMER(
    CID     VARCHAR2(10) PRIMARY KEY,
    CNAME   VARCHAR2(5),
    CADDR   CHAR(20),
    CPOST   NUMBER(6),
    CTEL    VARCHAR2(15)
   );
--2．货物信息stock_info
--货物号sid、货物名称sname、单价sprice

CREATE TABLE STOCK(
    SID   NUMBER(9)     PRIMARY KEY,
    SNAME VARCHAR2(20)  UNIQUE,
    SPRICE NUMBER(8,2)    NOT NULL
)
    
--3．订单信息purchase_info
--订单号Pid、订单客户cid、订货日期pdate、发货日期fdate、发货地址faddr、邮编fpost

CREATE TABLE PURCHASE(
    PID   NUMBER(10) PRIMARY KEY,
    CID   VARCHAR2(10),
    PDATE  DATE,
    FDATE  DATE,
    PADDR  VARCHAR2(13),
    PPOST  NUMBER(6),
    CONSTRAINT FK_PUR_CUM FOREIGN KEY(CID) REFERENCES CUSTOMER(CID),
);
--4．订货条目信息items_info
--条目编号iid、订单号pid、货物号sid、数量snum、折扣discount
CREATE TABLE ITEMS(
    IID  NUMBER(10) PRIMARY KEY,
    PID  NUMBER(10),
    SID  NUMBER(9),
    SNUM NUMBER(5),
    DISCOUNT NUMBER(3,3),  
    CONSTRAINT ITEMS_STOCK_FK FOREIGN KEY(SID) REFERENCES STOCK(SID),
    CONSTRAINT ITEMS_PURCHASE_FK FOREIGN KEY(PID) REFERENCES PURCHASE(PID)
);
SELECT * FROM ITEMS

--向CUSTOMER表中输入数据
INSERT INTO CUSTOMER VALUES(TO_CHAR(1,'0000'),'张一','北京',120111,'010-123456');
INSERT INTO CUSTOMER VALUES(TO_CHAR(2,'0000'),'张二','天津',120222,'022-123456');
INSERT INTO CUSTOMER VALUES(TO_CHAR(3,'0000'),'张三','上海',120333,'021-123456');
COMMIT;
SELECT * FROM CUSTOMER

--向STOCK表中输入数据
INSERT INTO STOCK VALUES(1001,'鸡蛋',1);
INSERT INTO STOCK VALUES(1002,'面包',2);
INSERT INTO STOCK VALUES(1003,'火腿肠',5);
COMMIT;
SELECT * FROM STOCK

--向PURCHASE表中输入数据
INSERT INTO PURCHASE VALUES(9001,TO_CHAR(1,'0000'),'12-4月-1998','7-6月-1998','李一',1234);
INSERT INTO PURCHASE VALUES(9002,TO_CHAR(2,'0000'),'12-6月-1999','7-6月-1999','李二',2234);
INSERT INTO PURCHASE VALUES(9003,TO_CHAR(3,'0000'),'12-7月-1999','7-8月-2001','李三',3234);
commit;
select * from purchase for update
SELECT * FROM PURCHASE
--向ITEMS表中输入数据
INSERT INTO ITEMS VALUES(1001,9001,1001,5,0.2);
INSERT INTO ITEMS VALUES(1002,9002,1002,4,0.1);
INSERT INTO ITEMS VALUES(1003,9003,1003,5,0.2);

COMMIT;
SELECT * FROM ITEMS FOR UPDATE

--1．查询订单号为9001订单的客户信息和订货详细信息。
 SELECT  C.CID,C.CNAME,C.CADDR,C.CPOST,C.CTEL,I.SID,I.SNUM
 FROM PURCHASE P,CUSTOMER C,ITEMS I
 WHERE P.PID=9001 AND P.CID=C.CID AND  P.PID=I.PID;
 
--2．查询每张订单的订货详细信息
 SELECT *
 FROM PURCHASE
 
 --3．统计每一个订货单的总价值
SELECT I.PID, S.SPRICE*I.SNUM*(1-I.DISCOUNT) "总价格"
FROM ITEMS I,STOCK S
WHERE I.SID=S.SID

--4．查询涉及货物1003的订货单及订货条目信息
SELECT I.PID,I.IID
FROM ITEMS I,STOCK S
WHERE I.SID=S.SID AND I.SID=1003

--5．更改1001订货单中货物为1003的订货量
UPDATE ITEMS I SET I.SNUM=6 WHERE I.SID=1003 AND I.PID=9003
SELECT * FROM ITEMS
--6．删除编号为9001的订货单
DELETE FROM ITEMS WHERE PID=9001;
DELETE FROM PURCHASE WHERE PID=9001;


SELECT * FROM ITEMS
SELECT * FROM PURCHASE



